import{m as h,f as y,_ as E,u as V,e as D,r as B,n as L,o as S,c as F,a as o,b as m,a3 as b,q as _,a4 as N,a5 as x,z as g,a0 as f,F as z,p as T,d as M,a6 as U,N as c,a7 as K,a8 as v,Q as q}from"./index.54d239d6.js";/* empty css              */function Q(t){const e=h({isCountDown:!1,count:60,url:"",loadImg:!1,tip:"",loadError:!1,timer:null}),u=()=>{e.timer&&clearInterval(e.timer);const s=t.value.getElementsByTagName("img")[0];s&&t.value.removeChild(s),e.loadImg=!0,e.isCountDown=!1,e.loadError=!1,e.url="/api/kaptcha?t="+Date.now();const l=document.createElement("img");l.src=e.url,l.addEventListener("load",()=>{e.isCountDown=!0,e.loadImg=!1,e.loadError=!1,e.count=60,t.value.appendChild(l),e.timer=setInterval(()=>{e.count===0?(e.isCountDown=!1,e.count=60,clearInterval(e.timer),e.timer=null):e.count--},1e3)}),l.addEventListener("error",()=>{e.loadImg=!1,e.loadError=!0,e.isCountDown=!1,e.count=60})};return y(()=>{u(),t.value.addEventListener("click",()=>u())}),e}const d=t=>(T("data-v-c8a88387"),t=t(),M(),t),j={class:"form"},A={class:"item"},G=d(()=>o("div",{class:"btn"},"\u7528\u6237\u540D",-1)),H={class:"field"},J=d(()=>o("div",{class:"deco"},null,-1)),O={class:"item"},P=d(()=>o("div",{class:"btn"},"\u5BC6\u7801",-1)),X={class:"field"},Y=d(()=>o("div",{class:"deco"},null,-1)),Z={class:"check-code"},$={class:"item"},R=d(()=>o("div",{class:"btn"},"\u9A8C\u8BC1\u7801",-1)),W={class:"field"},ee=d(()=>o("div",{class:"deco"},null,-1)),oe={class:"right-info"},se=g(" \u767B\u5F55 "),te=d(()=>o("div",{class:"deco"},null,-1)),ae=[se,te],ne={__name:"LoginForm",setup(t){const e=V(),u=D(),s=h({username:"",password:"",code:""}),l=B(null),r=Q(l),w=L(()=>r.loadImg?"\u52A0\u8F7D\u4E2D...":r.loadError?"\u56FE\u7247\u52A0\u8F7D\u5931\u8D25":r.isCountDown?"\u9A8C\u8BC1\u7801\u5C06\u5728"+r.count+"s\u540E\u8FC7\u671F":"\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u70B9\u51FB\u5237\u65B0"),C=()=>e.push("/form/sign"),I=async()=>{if(await U(),s.username==="")return c({type:"danger",message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"});if(s.password==="")return c({type:"danger",message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"});if(s.code==="")return c({type:"danger",message:"\u9A8C\u8BC1\u7801\u4E0D\u80FD\u4E3A\u7A7A"});try{const a=await K(s.code,s.username,s.password);if(a.code===300)c({type:"danger",message:a.msg}),s.code="";else if(a.code===200){localStorage.setItem("token",a.data.token),u.dispatch("validateToken",a.data.token),v({showCancelButton:!1,message:"\u767B\u5F55\u6210\u529F\uFF0C\u524D\u5F80\u9996\u9875",showConfirmButton:!1});const n=setTimeout(()=>{clearTimeout(n),v.close(),e.replace("/")},1e3)}}catch(a){console.log(a),s.username="",c({type:"danger",message:"\u7528\u6237\u4E0D\u5B58\u5728"})}};return(a,n)=>{const p=z,k=q;return S(),F("div",j,[o("div",A,[G,o("div",H,[m(p,{modelValue:s.username,"onUpdate:modelValue":n[0]||(n[0]=i=>s.username=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",size:"large"},null,8,["modelValue"])]),J]),o("div",O,[P,o("div",X,[m(p,{modelValue:s.password,"onUpdate:modelValue":n[1]||(n[1]=i=>s.password=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password",size:"large"},null,8,["modelValue"])]),Y]),o("div",Z,[o("div",$,[R,o("div",W,[m(p,{modelValue:s.code,"onUpdate:modelValue":n[2]||(n[2]=i=>s.code=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",size:"large"},null,8,["modelValue"])]),ee]),o("div",oe,[o("div",{class:b(["check-code-img",_(r).loadError?"error":""]),ref_key:"imgWrap",ref:l},[N(m(k,{color:"#F2C32B"},null,512),[[x,_(r).loadImg]]),g(" "+f(_(r).loadError?"\u70B9\u51FB\u91CD\u8BD5":""),1)],2),g(" "+f(_(w)),1)])]),o("div",{class:"item login",onClick:I},ae),o("button",{class:"go-btn",onClick:C},"\u6CE8\u518C")])}}},de=E(ne,[["__scopeId","data-v-c8a88387"]]);export{de as default};
